import pygame, sys
from random import randrange


class Game:

    def __init__(self):
        pygame.init()
        self.ball_radius = 10
        self.ball_sp = 6
        self.ball_rect = int(self.ball_radius * 2 ** 0.5)
        self.fps = 60
        self.FAKE_WIDTH = 1450
        self.WIDTH = 1200
        self.HEIGHT = 800
        self.win1 = pygame.display.set_mode((self.FAKE_WIDTH, self.HEIGHT))
        pygame.display.set_caption('ARCANOID')
        # , pygame.FULLSCREEN
        self.clock = pygame.time.Clock()
        self.img = pygame.image.load('background2.jpg').convert()
        self.img2 = pygame.image.load('1.jpg').convert()
        self.f1 = pygame.font.Font(None, 36)
        self.score_font = pygame.font.SysFont('Calibri', 36)
        self.score_1 = 0
        self.score = self.score_font.render(str(self.score_1), True, pygame.Color('green'))
        self.text1 = self.f1.render('Your score: ' + '0', 1, pygame.Color('green'))
        self.dx = 1
        self.dy = -1
        self.ball = pygame.Rect(randrange(self.ball_rect, self.WIDTH - self.ball_rect), int(self.HEIGHT // 1.5),
                                self.ball_rect, self.ball_rect)
        self.hit_rect = None
        self.hit_color = None
        self.block_list = [pygame.Rect(40 + 90 * i, 15 + 35 * j, 75, 30) for i in range(12) for j in range(10)]
        self.color_list = [(randrange(50, 256), randrange(50, 256), randrange(50, 256)) for i in range(12) for j in
                           range(10)]
        self.delta_x = None
        self.delta_y = None
        self.hit_index = None
        self.message = None
        self.platform()

    def detect_collision(self):
        if self.dx > 0:
            self.delta_x = self.rect.right - self.ball.left
        else:
            self.delta_x = self.ball.right - self.rect.left
        if self.dy > 0:
            self.delta_y = self.rect.bottom - self.ball.top
        else:
            self.delta_y = self.ball.bottom - self.rect.top
        if abs(self.delta_y - self.delta_x) < 10:
            self.dx, self.dy = - self.dx, - self.dy
        elif self.delta_x > self.delta_y:
            self.dy = - self.dy
        elif self.delta_y > self.delta_x:
            self.dx = - self.dx
        return self.dx, self.dy

    def platform(self):
        self.paddle_w = 150
        self.paddle_h = 30
        self.paddle_sp = 15
        self.paddle = pygame.Rect(self.WIDTH // 2 - self.paddle_w // 2, self.HEIGHT - self.paddle_h - 10,
                                  self.paddle_w, self.paddle_h)
        self.rect = pygame.draw.rect(self.win1, pygame.Color('yellow'), self.paddle)

    def collecting_score(self):
        self.text1 = self.f1.render(f'Your score: {self.score_1}', 1, pygame.Color('green'))

    def press_keyboard(self):
        while True:
            for event in pygame.event.get():
                if event.type == pygame.KEYDOWN:
                    if event.key == pygame.K_ESCAPE:
                        exit()
            self.win1.blit(self.img, (0, 0))
            self.win1.blit(self.img2, (1203, 0))
            self.win1.blit(self.text1, (1210, 10))
            keys = pygame.key.get_pressed()
            if keys[pygame.K_LEFT] and self.paddle.left > 0:
                self.paddle.left -= self.paddle_sp
            if keys[pygame.K_RIGHT] and self.paddle.right < self.WIDTH:
                self.paddle.right += self.paddle_sp

            [pygame.draw.rect(self.win1, self.color_list[color], block) for color, block in enumerate(self.block_list)]
            pygame.draw.rect(self.win1, pygame.Color('yellow'), self.paddle)
            pygame.draw.circle(self.win1, pygame.Color('red'), self.ball.center, self.ball_radius)
            self.ball.x += self.ball_sp * self.dx
            self.ball.y += self.ball_sp * self.dy
            if self.ball.centerx < self.ball_radius or self.ball.centerx > self.WIDTH - self.ball_radius:
                self.dx = - self.dx
            if self.ball.centery < self.ball_radius:
                self.dy = - self.dy
            if self.ball.colliderect(self.paddle) and self.dy > 0:
                self.dx, self.dy = self.dx, - self.dy
            self.hit_index = self.ball.collidelist(self.block_list)
            if self.hit_index != -1:
                self.hit_rect = self.block_list.pop(self.hit_index)
                self.hit_color = self.color_list.pop(self.hit_index)
                self.dx, self.dy = self.detect_collision()
                self.score_1 += 1
                self.collecting_score()
            if self.ball.bottom > self.HEIGHT:
                exit()
            elif not len(self.block_list):
                print("YOU WIN!")
                exit()
            pygame.display.flip()
            self.clock.tick(self.fps)


A = Game()
A.press_keyboard()
A.detect_collision()
